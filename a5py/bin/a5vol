#!/usr/bin/env python3

import a5py.postprocessing.vol_elem_mc as vol_elem_mc
from a5py.ascot5io.ascot5file import get_activeqid
import sys
import h5py
import numpy as np

if len(sys.argv) < 2:
   print('Usage: a5vol fname')
   sys.exit(0)

fn = sys.argv[1]

print('Calculating volume elements...')

V_bin = vol_elem_mc.volume_elements_rho(fn)

print('Total tolume: ', np.sum(V_bin))

f = h5py.File(fn, 'a')
qid = get_activeqid(f, 'results')
path = 'results/run_' + qid + '/distrho5d/'
if 'vol' in f[path]:
   del f[path]['vol']
f.create_dataset(path + 'vol', data=V_bin)

print('Volumes written to ' + fn + '.')
