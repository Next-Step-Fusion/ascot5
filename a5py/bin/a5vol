#!/usr/bin/env python3

import a5py.postprocessing.vol_elem_mc as vol_elem_mc
from a5py.ascot5io.ascot5 import get_qids
import sys

if len(sys.argv) < 2:
   print("Usage: a5vol fname")
   sys.exit(0)

fn = sys.argv[1]

print('Calculating volume elements...')

V_bin, V_tot, n_tot = vol_elem_mc.volume_elements_rho(fn)

print('Used ' + str(n_tot) + ' test points. Total volume: ' + str(V_tot) + '.')

f = h5py.File(fn, "a")
qids = get_qids(fn, "results")
qid = qids[0]
path = "results/run-" + qid + "/dists/"
f.create_dataset(path + "rho_pol_phi_vpa_vpe_t_q/" + "vol", data=V_bin)

print('Volumes written to ' + fn + '.')
